<?php
include("fusioncharts.php");
$hostdb = "127.0.0.1";  // MySQl host
$userdb = "root";  // MySQL username
$passdb = "wso2123";  // MySQL password
$namedb = "TaskOpenPulls";  // MySQL database name
$dbhandle = new mysqli($hostdb, $userdb, $passdb, $namedb);
if ($dbhandle->connect_error) {
  exit("There was an error with your connection: ".$dbhandle->connect_error);
}
?>

<html>
   <head>
      <title>FusionCharts | Multi-Series Chart using PHP and MySQL</title>
        <script src="http://static.fusioncharts.com/code/latest/fusioncharts.js"></script>
        <script src="http://static.fusioncharts.com/code/latest/fusioncharts.charts.js"></script>
        <script src="http://static.fusioncharts.com/code/latest/themes/fusioncharts.theme.fint.js"></script>
   </head>
   <body>

<?php

  $strQuery = "SELECT DISTINCT product,MaxNoOpenHours,MinNoOpenHours,AvgNoOpenHours FROM GraphData; ";
 	$result = $dbhandle->query($strQuery) or exit("Error code ({$dbhandle->errno}): {$dbhandle->error}");
  if ($result) {

	$arrData = array(
        "chart" => array(
        	  "caption"=> "Analysis on wso2 pull requests",
            "captionFontSize"=> "18",
            "captionFontColor"=> "#993300",
              "bgColor"=> "#DDDDDD",
            "bgAlpha"=> "50",


            "xAxisname"=> "Products",
            "yAxisName"=> "Number of open hours",
            "height"=>"1000",
            "width"=>"800",
            "plotFillAlpha"=> "80",
        	   "showValues"=> "1",
              "placeValuesInside"=> "1",
            "rotateValues"=> "1",
            "valueFontColor"=> "#000000",
        	
            



        	  "usePlotGradientColor"=> "0",
        	  
        	  
        	  "showHoverEffect"=> "2",
        	  // // "labelDisplay"=>"ROTATE",
              "slantLabels"=>"2",
            // "rotateValues"=> "1",
            "showXAxisLine"=> "1",
            "xAxisLineThickness"=> "1",
            "xAxisLineColor"=> "#999999",
            "showAlternateHGridColor"=> "0",
            "legendBgAlpha"=> "0",
            "legendBorderAlpha"=> "0",
             "legendShadow"=> "0",
            "legendIconScale"=>"3",

            "yAxisMaxValue"=> "1600",
            "yAxisMinValue "=> "0",
            "Numdivlines"=>"12",
            "legendItemFontSize"=> "10",
            "legendItemFontColor"=> "#666666",
           //  "theme"=> "fint",

            "xAxisNameFont"=> "Arial",
            "xAxisNameFontSize"=> "18",
            "xAxisNameFontColor"=> "#993300",
            "xAxisNameFontBold"=> "1",
            "xAxisNameFontItalic"=> "1",
            "xAxisNameAlpha"=> "80",
             "outCnvBaseFontSize"=> "12",


            "yAxisNameFont"=> "Arial",
            "yAxisNameFontSize"=> "15",
            "yAxisNameFontColor"=> "#993300",
            "yAxisNameFontBold"=> "1",
            "yAxisNameFontItalic"=> "1",
            "yAxisNameAlpha"=> "80",
          	)
         	);
        	// creating array for categories object

        	$categoryArray=array();
        	$dataseries1=array();
        	$dataseries2=array();
          $dataseries3=array();

          // pushing category array values
        	while($row = mysqli_fetch_array($result)) {
				    array_push($categoryArray, array(
					  "label" => $row["product"]
					)
				);
				array_push($dataseries1, array(
					"value" => $row["MaxNoOpenHours"]
					)
				);

				array_push($dataseries2, array(
					"value" => $row["MinNoOpenHours"]
					)
				);
        array_push($dataseries3, array(
					"value" => $row["AvgNoOpenHours"]
					)
				);

    	}

    	$arrData["categories"]=array(array("category"=>$categoryArray));
			// creating dataset object
			$arrData["dataset"] = array(array("seriesName"=> "MaxNoOpenHours","color"=> "#b71d09", "data"=>$dataseries1), array("seriesName"=> "MinNoOpenHours", "color"=> "#0c047c",  "renderAs"=>"line", "data"=>$dataseries2),array("seriesName"=> "AvgNoOpenHours", "color"=> "#349949", "renderAs"=>"area", "data"=>$dataseries3));



      $jsonEncodedData = json_encode($arrData);

			// chart object
      $msChart = new FusionCharts("mscolumn2d", "chart1" , "100%", "400", "chart-container", "json", $jsonEncodedData);

      $msChart->render();

      // closing db connection
      $dbhandle->close();

   }

?>

<center>
 <div id="chart-container">Chart will render here!</div></center>
   </body>
</html>
